<!doctype html><meta charset="utf-8">
<title>Camera Hard Test (GitHub Pages)</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden;font:14px system-ui}
  #v{position:fixed;inset:0;width:100vw;height:100vh;object-fit:cover;background:#000}
  #hud{position:fixed;left:10px;top:10px;color:#fff;z-index:10;white-space:pre;max-width:70vw}
  #bar{position:fixed;right:10px;top:10px;z-index:10;display:flex;gap:6px;flex-wrap:wrap}
  button,select{padding:.4rem .6rem;border-radius:.5rem;border:1px solid #777;background:#111;color:#fff}
</style>
<div id="hud">init‚Ä¶</div>
<div id="bar">
  <button onclick="openCam()">Default</button>
  <button onclick="openCam({video:{facingMode:{ideal:'environment'}}})">Environment</button>
  <button onclick="openCam({video:{facingMode:'user'}})">User</button>
  <select id="cams" onchange="pickDevice()"></select>
  <button onclick="stopCam()">Stop</button>
</div>
<video id="v" autoplay playsinline muted></video>
<script>
const v = document.getElementById('v');
const hud = document.getElementById('hud');
const sel = document.getElementById('cams');
let stream=null;

function log(...a){ const s=a.join(' '); hud.textContent=(hud.textContent+'\n'+s).trim(); console.log(s); }

async function permState(){
  try{ const p = await (navigator.permissions?.query?.({name:'camera'}) || null);
       log('permission:', p? p.state : 'unknown'); }catch{}
}

async function list(){
  const devs = await navigator.mediaDevices.enumerateDevices().catch(e=>{log('enumerate ERR',e.name); return []});
  sel.innerHTML='';
  devs.filter(d=>d.kind==='videoinput').forEach((d,i)=>{
    const o=document.createElement('option');
    o.value=d.deviceId; o.textContent=d.label||`camera ${i+1}`;
    sel.appendChild(o);
  });
  log('cameras:', sel.options.length);
}

async function openCam(constraints){
  try{
    stopCam();
    const c = constraints || {video:true};
    stream = await navigator.mediaDevices.getUserMedia(c);
    v.srcObject = stream;
    await v.play().catch(()=>{});
    await list();
    log('OK', v.videoWidth+'x'+v.videoHeight, JSON.stringify(c));
  }catch(e){
    log('ERR', e.name, e.message);
    if (e.name==='NotAllowedError') log('HINT: ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîí ‡∏Ç‡πâ‡∏≤‡∏á URL > Camera = Allow ‡πÅ‡∏•‡πâ‡∏ß Reload');
    if (e.name==='NotFoundError')  log('HINT: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏•‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠ OS ‡∏õ‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå');
    if (e.name==='NotReadableError') log('HINT: ‡πÅ‡∏≠‡∏õ‡∏≠‡∏∑‡πà‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∂‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á (Zoom/Teams/OBS) ‡∏õ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô');
  }
}
function stopCam(){ if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; } }
async function pickDevice(){ const id = sel.value; if(!id) return;
  await openCam({video:{deviceId:{exact:id}}}); }

(async ()=>{
  log('navigator', !!navigator, 'mediaDevices', !!navigator.mediaDevices);
  await permState();
  await list();
  // ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö environment ‡∏Å‡πà‡∏≠‡∏ô
  await openCam({video:{facingMode:{ideal:'environment'}}});
})();
</script>
