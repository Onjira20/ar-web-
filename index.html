<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WebAR ‚Äì MindAR + Three.js (‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏≠‡∏á)</title>
<style>
  html,body{margin:0;height:100%;background:#000;overflow:hidden}
  /* ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà */
  #v{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;background:#000;z-index:0;display:block}
  /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå 3D ‡∏à‡∏∞‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ */
  #app{position:fixed;inset:0}
  #app canvas{position:fixed;inset:0;z-index:1;background:transparent}
  #status{position:fixed;left:.75rem;top:.75rem;color:#fff;z-index:2;font:13px system-ui}
</style>
<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"></script>
</head>
<body>
  <!-- ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡∏™‡∏ï‡πå -->
  <video id="v" autoplay playsinline muted></video>
  <div id="app"></div>
  <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‚Ä¶</div>

<script>
const TARGETS = './mindar/targets1.mind';
const MODEL   = './model/spino.glb';

const videoEl = document.getElementById('v');
const appEl   = document.getElementById('app');
const statusEl= document.getElementById('status');

let mindarThree, renderer, scene, camera;

// 1) ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô (‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß) ‚Äî ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡πÅ‡∏ó‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡∏™‡∏ï‡πå
async function openCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:{ ideal:'environment' } } });
    videoEl.srcObject = stream;
    await videoEl.play().catch(()=>{});
    statusEl.textContent = '‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î AR‚Ä¶';
  } catch (e) {
    statusEl.textContent = '‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô üîí ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤';
    throw e;
  }
}

// 2) ‡πÇ‡∏´‡∏•‡∏î MindAR + Three ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
async function startAR() {
  const MindARThree = window.MINDAR.IMAGE.MindARThree;
  mindarThree = new MindARThree({
    container: appEl,
    imageTargetSrc: TARGETS,
    video: videoEl,               // ‚òÖ ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏á
    uiScanning: 'yes',
    uiLoading : 'no'
  });
  ({renderer, scene, camera} = mindarThree);
  renderer.setClearColor(0x000000, 0);      // ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡∏ó‡∏±‡∏ö‡∏ö‡∏ô‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));

  // ‡πÅ‡∏™‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
  scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 1.0));

  // ‡πÄ‡∏õ‡πâ‡∏≤‡∏†‡∏≤‡∏û index 0
  const anchor = mindarThree.addAnchor(0);

  // ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• 3D
  new THREE.GLTFLoader().load(MODEL, (gltf)=>{
    const o = gltf.scene;
    o.position.set(0, 1, 0);
    o.rotation.set(THREE.Math.degToRad(-90), 0, 0);
    o.scale.set(0.5, 0.5, 0.5);
    anchor.group.add(o);
  });

  anchor.onTargetFound = ()=> statusEl.textContent = '‡∏û‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!';
  anchor.onTargetLost  = ()=> statusEl.textContent = '‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πâ‡∏≤';

  await mindarThree.start();
  renderer.setAnimationLoop(()=> renderer.render(scene, camera));
  statusEl.textContent = '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Äî ‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πâ‡∏≤';
}

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
(async()=>{
  await openCamera();      // ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
  await startAR();         // ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏° MindAR
})();
</script>
</body>
</html>
